<% title = l(:label_pull_request_show) %>

<% html_title title %>

<% content_for :header_tags do %>
<%= stylesheet_link_tag 'scm' %>
<style>
label {
	width: 100px; display: inline-block; vertical-align: top; font-weight: bold;
}
</style>
<% end %>

<h2><%= title %> #<%= @pull.id %></h2>

<div class="box">
<% if @pull.title.present? %>
<h3><%= @pull.title %></h3>
<% end -%>

<p>
<label><%= l(:label_status) %>:</label>
<span><%= @pull.status.camelize %></span>
</p>

<p>
<label><%= l(:label_repository) %>:</label>
<span><%= @pull.repository.name %></span>
</p>

<p>
<label><%= l(:label_base_branch) %>:</label>
<span><%= @pull.base_branch %></span>
</p>

<p>
<label><%= l(:label_head_branch) %>:</label>
<span><%= @pull.head_branch %></span>
</p>

<p>
<label><%= l(:field_description) %></label>
<div><%= textilizable @pull.description %></div>
</p>

</div>

<% if @merge_conflict %>
<div class="flash error"><%= l(:notice_pull_cant_be_merged) %></div>
<% end -%>

<p>
<% labelled_form_for :pull, :url => { :action => "review", :project_id => @project.identifier }, :html => { :method => :put } do |f| %>
<%= f.submit l(:button_review_pull_request), :disabled => @button_disable %>
<% end -%>

<% unless @merge_conflict %>
<% labelled_form_for :pull, :url => { :action => "merge", :project_id => @project.identifier }, :html => { :method => :put } do |f| %>
<%= f.submit l(:button_merge_pull_request), :disabled => @button_disable %>
<% end -%>
<% end -%>

<% labelled_form_for :pull, :url => { :action => "close", :project_id => @project.identifier }, :html => { :method => :put } do |f| %>
<%= f.submit l(:button_close_pull_request), :disabled => @button_disable %>
<% end -%>

<% labelled_form_for :pull, :url => { :action => "cancel", :project_id => @project.identifier }, :html => { :method => :put } do |f| %>
<%= f.submit l(:button_cancel_pull_request), :disabled => @button_cancel_disable %>
<% end -%>
</p>

<% if @base_branch and @head_branch %>
<style type="text/css">
ul {
  padding: 0;
}
ul.smalltabs {
margin: 15px 0 15px 0;
height: 24px;
line-height: 24px;
font-size: 12px;
color: #555;
text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
background: #E8E8E8;
background: -moz-linear-gradient(#E8E8E8,#D2D2D2);
background: -webkit-linear-gradient(#E8E8E8,#D2D2D2);
-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='#e8e8e8',endColorstr='#d2d2d2')";
border: 1px solid #D1D1D1;
border-bottom-color: #BBB;
border-radius: 3px;
}
ul.smalltabs li {
list-style-type: none;
display: inline;
}
ul.smalltabs li:first-child a.selected {
border-top-left-radius: 3px;
border-bottom-left-radius: 3px;
}
ul.smalltabs li:first-child a {
border-left: none;
}
ul.smalltabs a.selected {
color: 
#333;
background: white;
background: -moz-linear-gradient(white,#F2F2F2);
background: -webkit-linear-gradient(white,#F2F2F2);
-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='white',endColorstr='#f2f2f2')";
}
ul.smalltabs a {
float: left;
height: 24px;
padding: 0 7px;
color: #666;
font-weight: bold;
text-decoration: none;
border-right: 1px solid #ABABAB;
border-left: 1px solid #F6F6F6;
}
</style>

<ul class="js-hard-tabs  smalltabs" id="smalltabs">
<li><a href="#" name="status" onclick="selectTab(this); return false;" class="selected"><%= l(:label_status)%> (<%= @statuses.length %>)</a></li>
<li><a href="#" name="commits" onclick="selectTab(this); return false;"><%= l(:label_commits) %> (<%= @revisions.length %>)</a></li>
<li><a href="#" name="files" onclick="selectTab(this); return false;"><%= l(:label_diff) %> (<%= @files.length %>)</a></li>
</ul>

<script type="text/javascript">
function selectTab(obj,bucket) {
  tabs = $('smalltabs').children
  for (var i = tabs.length - 1; i >= 0; i--) {
    a = tabs[i].children[0];
    bucket = a.name + "_bucket";
    if(a == obj) {
      $(bucket).style.display = 'block';
      a.className = 'selected';
    } else {
      $(bucket).style.display = 'none';
      a.className = '';
    }
  }
  return false;
}
function bindTabs() {
  tabs = $('smalltabs').children
  for (var i = tabs.length - 1; i >= 0; i--) {
    tab = tabs[i];
    a = tab.children[0];
    a.onClick = click;
  };
}
//bindTabs();
</script>

<div id="status_bucket" style="display: block;">
  <% if @statuses %>
  <h3><%= l(:label_status) %></h3>
  <p>
  <%= render :partial => 'statuses' %>
  </p>
  <% end -%>
</div>

<div id="commits_bucket" style="display: none;">
  <h3><%= l(:label_commits) %></h3>
  <p>
  <% if @revisions %>
  <%= render :partial => 'revisions' %>
  <% end -%>
  </p>
</div>

<div id="files_bucket" style="display: none;">
  <h3>
  <%= l(:label_file_changed) %> 
  </h3>

  <p>
  <% if @files %>
  <%= render :partial => 'files' %>
  <% end -%>
  </p>

  <p>

  <% cache(@cache_key) do -%>
  <% if @diff %>

  <!-- Choose view type -->
  <% form_tag({:path => to_path_param(@path)}, :method => 'get') do %>
    <%= hidden_field_tag('base_branch', params[:base_branch]) if params[:base_branch] %>
    <%= hidden_field_tag('head_branch', params[:head_branch]) if params[:head_branch] %>
    <h3>
      <%= l(:label_diff) %>
      <%= select_tag 'type',
                      options_for_select(
                        [[l(:label_diff_inline), "inline"], [l(:label_diff_side_by_side), "sbs"]], @diff_type),
                      :onchange => "if (this.value != '') {this.form.submit()}" %>
    </h3>
  <% end %>


  <%= render :partial => 'common/diff', :locals => {:diff => @diff, :diff_type => @diff_type} %>
  <% end -%>
  <% end -%>
  </p>
</div>

<% end -%>


<%= render "sidebar" %>